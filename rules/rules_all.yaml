rules:
  # ========= GEN: общие требования к меддокументу =========
  - id: GEN-IDENT-HEADER
    title: Шапка документа — полная идентификация
    severity: major
    required: true
    order: "Общие требования к оформлению"
    where: "шапка; первая страница"
    llm_question: >
      Должны быть ФИО пациента, дата рождения/возраст, пол, ИИН (если указывается), номер истории,
      наименование медорганизации/отделения, даты поступления и выписки. При отсутствии любого из полей — FAIL.
      В evidence приведите цитаты найденных/отсутствующих полей.

  - id: GEN-DATES-CONSISTENT
    title: Хронология — даты не противоречат друг другу
    severity: major
    required: true
    order: "Общие требования к оформлению"
    where: "весь документ"
    llm_question: >
      Проверить, что даты и время не противоречат: поступление ≤ осмотр(ы) ≤ процедуры ≤ выписка.
      Любые обратные ходы времени или невозможные интервалы — FAIL. В evidence дайте пары дат/времени.

  - id: GEN-ICD10-CODING
    title: Кодировка МКБ-10 для основного и сопутствующих диагнозов
    severity: minor
    required: true
    order: "Клинико-диагностическая часть"
    where: "диагнозы"
    llm_question: >
      У основного диагноза должен быть код МКБ-10; желательно также у сопутствующих/осложнений. Нет кода — FAIL (minor).
      Приведите цитату.

  - id: GEN-CONSENTS
    title: Информированные согласия — подписаны и датированы
    severity: major
    required: true
    order: "Правила ведения меддокументации"
    where: "блок согласий/приложений"
    llm_question: >
      Найти информированные согласия (на лечение/операцию/анестезию/переливание/ПДн).
      Для каждого: ФИО пациента (или законного представителя), подпись, дата. Отсутствие — FAIL.

  - id: GEN-LABS-DATED
    title: Лабораторные и инструментальные — с датами/сроковой связью с событиями
    severity: minor
    required: true
    order: "Диагностика"
    where: "анализы, инструментальные протоколы"
    llm_question: >
      Упоминания анализов/исследований должны сопровождаться датой; ключевые исследования — до клинических решений.
      Отсутствуют даты у значимых исследований — FAIL (minor). Приведите цитаты.

  - id: GEN-SIGNATURES
    title: Подписи и ФИО исполнителей
    severity: major
    required: true
    order: "Общие требования"
    where: "концы записей/протоколов/эпикризов"
    llm_question: >
      На ключевых записях/эпикризах/протоколах должны быть ФИО и подпись исполнителя (и/или должность).
      Нет подписи/ФИО — FAIL.

  - id: GEN-CORRECTIONS
    title: Оформление исправлений
    severity: minor
    required: true
    order: "Правила ведения меддокументации"
    where: "весь документ"
    llm_question: >
      Исправления должны быть внесены по правилам (оговорка, дата, подпись). Обнаружены нерегламентные исправления — FAIL (minor).

  - id: GEN-DISCHARGE-SUMMARY
    title: Выписной эпикриз — структура и итоги
    severity: major
    required: true
    order: "Эпикриз"
    where: "выписной эпикриз"
    llm_question: >
      Должны быть: окончательный диагноз (+МКБ), обоснование, проведенное лечение, исход, рекомендации,
      режим и диета на дому, контроль/сроки явки. Любая существенная часть отсутствует — FAIL.

  - id: GEN-MEDS-AT-DISCHARGE
    title: Рекомендованные препараты — с дозами/кратностью/сроком
    severity: minor
    required: true
    order: "Рекомендации"
    where: "рекомендации/лист назначений"
    llm_question: >
      Назначения при выписке должны содержать наименование, дозу, кратность, длительность/курсом.
      Если отсутствует ≥ одно из ключевых — FAIL (minor).

  - id: GEN-PAGINATION
    title: Нумерация страниц/цельность документа
    severity: minor
    required: false
    order: "Оформление"
    where: "весь документ"
    llm_question: >
      Проверьте наличие нумерации/цельности (необязательное). Явные провалы — FAIL (minor).

  # ========= STAC: стационар по Приказу №27 (и связям) =========
  - id: STAC-27-ER-WARD-EXAM-30MIN
    title: Осмотр врача отделения ≤ 30 минут при экстренной госпитализации
    severity: major
    required: true
    order: "Приказ 27 (стационар)"
    where: "приемное / осмотр отделения"
    llm_question: >
      Если указано «экстренно»: сравни время осмотра приемного и врача отделения. Интервал ≤ 30 минут.
      Нет времени или интервал > 30 минут — FAIL. Evidence: обе метки времени и интервал.

  - id: STAC-27-HEAD-PRIMARY-D0
    title: Первичный осмотр заведующим отделением в рабочее время
    severity: major
    required: true
    order: "Приказ 27"
    where: "первичный осмотр"
    llm_question: >
      Первичный осмотр выполняет Заведующий отделением в будни 09:00–18:00 (если не оговорено иначе).
      Другая должность или нерабочее время — FAIL. Evidence: должность, дата/время.

  - id: STAC-27-DIAG-JUSTIFY-D3
    title: Обоснование диагноза до 3-х суток + подпись заведующего
    severity: major
    required: true
    order: "Приказ 27"
    where: "обоснование диагноза"
    llm_question: >
      Найди дату поступления и дату обоснования. Срок ≤ 72 часа. Нужна отметка/подпись заведующего.
      Позже или без заведующего — FAIL.

  - id: STAC-27-PREOP-EPICRISIS-CONTENT
    title: Предоперационный эпикриз — показания, жалобы, анамнезы, соматический статус
    severity: major
    required: true
    order: "Приказ 27"
    where: "предоперационный эпикриз"
    llm_question: >
      Должны быть: показания к операции, жалобы, анамнез жизни, анамнез заболевания, соматический статус.
      Отсутствие любого — FAIL. Перечисли, чего нет.

  - id: STAC-27-OP-PROTOCOL-FIELDS
    title: Протокол операции — обязательные поля
    severity: critical
    required: true
    order: "Приказ 27"
    where: "протокол операции"
    llm_question: >
      Обязательно: АБ-профилактика; диагноз до/после; название операции; кровопотеря; осложнения; биопсия (если уместно);
      ФИО/роли: анестезиолог, медсестра, хирург. Отсутствие любого — FAIL.

  - id: STAC-27-ANES-OP-TIME-DELTA
    title: Анестезиология перед операцией (разрыв ≤ 30 минут)
    severity: major
    required: true
    order: "Приказ 27"
    where: "протокол анестезиологического пособия / протокол операции"
    llm_question: >
      Вначале протокол анестезиологического пособия, затем через ~20–30 минут — протокол операции.
      Разрыв часами (например 5 часов) — FAIL. Evidence: обе метки времени и разница.

  - id: STAC-27-POSTOP-NOTE
    title: Наличие послеоперационного дневника
    severity: major
    required: true
    order: "Приказ 27"
    where: "послеоперационный дневник"
    llm_question: >
      После операции должен быть послеоперационный дневник. Отсутствует — FAIL.

  - id: STAC-27-TRANSFUSION-PRE-EPICRISIS
    title: Предтрансфузионный эпикриз — обязательные параметры
    severity: critical
    required: true
    order: "Приказ 27"
    where: "предтрансфузионный эпикриз"
    llm_question: >
      Обязательно указать: дату ОАК, дату КЩС перед трансфузией, пульс, АД, сатурацию, гемоглобин.
      Любое отсутствие — FAIL (critical).

  - id: STAC-27-CPR-LOG-30MIN
    title: СЛР — 30 минут с фиксацией каждые 5 минут
    severity: critical
    required: true
    order: "Приказ 27"
    where: "дневники / реанимация"
    llm_question: >
      Если проводилась СЛР: запись не менее 30 минут, со стоп-анализом каждые 5 минут.
      Нет длительности/5-мин контроля — FAIL.

  - id: STAC-27-SEVERE-3H-NOTES
    title: При тяжёлом состоянии — дневники каждые 3 часа
    severity: major
    required: true
    order: "Приказ 27"
    where: "дневниковые записи"
    llm_question: >
      При оценке «тяжёлое» записи не реже, чем каждые 3 часа. Нарушено — FAIL.

  - id: STAC-27-CLINICAL-DIAG-D3
    title: Основной клинический диагноз на 3-и сутки
    severity: major
    required: true
    order: "Приказ 27"
    where: "диагноз/эпикриз"
    llm_question: >
      К 3-м суткам основной клинический диагноз должен быть явно отмечен. Нет — FAIL.

  - id: STAC-27-STAGE-EPICRISIS-D10
    title: Этапный эпикриз на 10-е сутки
    severity: minor
    required: true
    order: "Приказ 27"
    where: "этапный эпикриз"
    llm_question: >
      На 10-е сутки должен быть этапный эпикриз. Нет/позже — FAIL (minor).

  - id: STAC-27-CONSILIUM-D3-SEVERE
    title: Консилиум ≥3 врачей к 3-м суткам при тяжёлом состоянии
    severity: major
    required: true
    order: "Приказ 27"
    where: "консилиум"
    llm_question: >
      При тяжёлом состоянии — консилиум минимум из 3 врачей к 3-м суткам. Нет — FAIL.

  - id: STAC-27-PRESCRIPTION-DIET-REGIMEN
    title: Лист назначений/выписка — Диета и Режим обязательно
    severity: minor
    required: true
    order: "Приказ 27"
    where: "лист назначений / рекомендации / проведённое лечение"
    llm_question: >
      Должны быть явные поля «Диета: …» и «Режим: …». Если указано «Не указано» или поля отсутствуют — FAIL.
      Корректные примеры: Диета №5А/9/10; Режим 2б палатный/3а свободный и т.п.
